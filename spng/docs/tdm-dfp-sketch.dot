digraph tdm {

    // graph [splines=ortho];

    label="Conceptual sketch for TDM DFP graph assuming wrapped/jumperred (DUNE VD/HD) anodes.\nU/V are symmetric, W specially skips crossviews.\nInternal edges are all single-tensor.  Fanin/fanouts are left implicit.\nThe 'wiener' boxes filter to maximize signal/noise, 'dense' filters are eg loose LF.\nA choice between order of upsample and threshold is reflected in U/V asymmetry\nRetraining a DNNROI-like net can allow for than just MP2/MP3 boolean cross-views features."

    node[shape=ellipse]
    adc_frame
    signals_v signals_u signals_w
    signal_frame
    mp2_u mp3_u
    mp2_v mp3_v
    mp2_w mp3_w
    signal_tensor_set
    node[shape=box]

    {rank=same dense_u->dense_v->crossviews_u->crossviews_v[style=invis]}
    {rank=same dense_ds_u->extract_u->dense_ds_v->extract_v->dense_ds_w->extract_w[style=invis]}
    decon_u->decon_v->decon_w1->decon_w2 [style=invis]    
    crossviews_u->crossviews_v[style=invis]
    {rank=same mp2_u->mp3_u[style=invis]}
    {rank=same mp2_v->mp3_v[style=invis]}
    {rank=same mp2_w->mp3_w[style=invis]}
    {rank=same gauss_u->roi_thresh_u->gauss_v->unbin_v->gauss_w[style=invis]}

    subgraph cluster_decon {
        label="decon by related channel group.\nFinal output 3 both-face (u/v/w) tensors "
        adc_tensor_set[shape=ellipse]
        frame_to_tdm
        ft_unpack
        regroup_w
        {rank=same decon_u, decon_v, decon_w1, decon_w2}        

    }
    subgraph cluster_initroi {
        label="initial roi"
        {rank=same wiener_u->wiener_v->wiener_w[style=invis]}
        {rank=same wiener_ds_u->wiener_ds_v->wiener_ds_w[style=invis]}
        {rank=same threshold_u->threshold_v->threshold_w[style=invis]}
        
    }

    adc_frame->frame_to_tdm->adc_tensor_set->ft_unpack
    ft_unpack->decon_u->gauss_u
    ft_unpack->decon_v->gauss_v
    ft_unpack->decon_w1->regroup_w
    ft_unpack->decon_w2->regroup_w->gauss_w

    decon_u->wiener_u->wiener_ds_u->threshold_u
    decon_v->wiener_v->wiener_ds_v->threshold_v
    regroup_w->wiener_w->wiener_ds_w->threshold_w

    threshold_u->crossviews_u
    threshold_v->crossviews_u
    threshold_w->crossviews_u->extract_u
    extract_u->mp2_u->stack_u
    extract_u->mp3_u->stack_u

    threshold_u->crossviews_v
    threshold_v->crossviews_v
    threshold_w->crossviews_v->extract_v
    extract_v->mp2_v->stack_v
    extract_v->mp3_v->stack_v

    decon_u->dense_u->dense_ds_u->stack_u
    decon_v->dense_v->dense_ds_v->stack_v

    stack_u->dnnroi_u->upsample_u->roi_thresh_u->multiply_u
    stack_v->dnnroi_v->roi_thresh_v->unbin_v->multiply_v
    wiener_w->threshold_full_w->multiply_w

    adc_tensor_set->ft_repack
    gauss_u->multiply_u->rebaseline_u->signals_u->ft_repack
    gauss_v->multiply_v->rebaseline_v->signals_v->ft_repack
    gauss_w->multiply_w->rebaseline_w->signals_w->ft_repack

    ft_repack->signal_tensor_set->tdm_to_frame->signal_frame

}

digraph tdm {

    // graph [splines=ortho];

    label="Conceptual sketch for TDM DFP graph assuming wrapped/jumperred (DUNE VD/HD) anodes.\nU/V/W are treated symmetric.  W cross views could be skipped. Internal edges are all single-tensor.  Fanin/fanouts are left implicit.\nThe 'wiener' boxes filter to maximize signal/noise, 'quiet' filters are eg loose LF.\nThe 'dnnroi' nodes are not yet TDM'ified. Retraining DNNROI allows for than just MP2/MP3 boolean cross-views features."

    node[shape=ellipse]
    adc_frame
    signals_v signals_u signals_w
    signal_frame
    mp2_u mp3_u
    mp2_v mp3_v
    mp2_w mp3_w
    signal_tensor_set
    node[shape=box]

    //{rank=same refilter_quiet_u refilter_quiet_v refilter_quiet_w mp2_u mp3_u mp2_v mp3_v mp2_w mp3_w}
    {rank=same quiet_u->extract_u->quiet_v->extract_v->quiet_w->extract_w[style=invis]}
    {rank=same crossviews_u crossviews_v crossviews_w}
    decon_u->decon_v->decon_w1->decon_w2 [style=invis]    
    crossviews_u->crossviews_v->crossviews_w[style=invis]
    {rank=same mp2_u->mp3_u[style=invis]}
    {rank=same mp2_v->mp3_v[style=invis]}
    {rank=same mp2_w->mp3_w[style=invis]}
    {rank=same gauss_u->dnnroi_u->gauss_v->dnnroi_v->gauss_w->dnnroi_w[style=invis]}

    subgraph cluster_decon {
        label="decon by related channel group.\nFinal output 3 both-face (u/v/w) tensors "
        adc_tensor_set[shape=ellipse]
        frame_to_tdm
        ft_unpack
        regroup_w
        {rank=same decon_u, decon_v, decon_w1, decon_w2}        

    }
    subgraph cluster_initroi {
        label="initial roi"
        {rank=same wiener_u->wiener_v->wiener_w[style=invis]}
        {rank=same threshold_u->threshold_v->threshold_w[style=invis]}
        
    }

    adc_frame->frame_to_tdm->adc_tensor_set->ft_unpack
    ft_unpack->decon_u->gauss_u
    ft_unpack->decon_v->gauss_v
    ft_unpack->decon_w1->regroup_w
    ft_unpack->decon_w2->regroup_w->gauss_w

    decon_u->wiener_u->threshold_u
    decon_v->wiener_v->threshold_v
    regroup_w->wiener_w->threshold_w

    threshold_u->crossviews_u
    threshold_v->crossviews_u
    threshold_w->crossviews_u->extract_u
    extract_u->mp2_u->stack_u
    extract_u->mp3_u->stack_u

    threshold_u->crossviews_v
    threshold_v->crossviews_v
    threshold_w->crossviews_v->extract_v
    extract_v->mp2_v->stack_v
    extract_v->mp3_v->stack_v

    threshold_u->crossviews_w
    threshold_v->crossviews_w
    threshold_w->crossviews_w->extract_w
    extract_w->mp2_w->stack_w
    extract_w->mp3_w->stack_w

    decon_u->quiet_u->stack_u
    decon_v->quiet_v->stack_v
    regroup_w->quiet_w->stack_w

    stack_u->dnnroi_u->applyroi_u
    stack_v->dnnroi_v->applyroi_v
    stack_w->dnnroi_w->applyroi_w

    adc_tensor_set->ft_repack
    gauss_u->applyroi_u->signals_u->ft_repack
    gauss_v->applyroi_v->signals_v->ft_repack
    gauss_w->applyroi_w->signals_w->ft_repack

    ft_repack->signal_tensor_set->tdm_to_frame->signal_frame

}

digraph deconflow {
    // interval
    node[shape=box]
    m[label="m = 2D measure",color=red] mp
    r[label="r = 2D response"] rp
    fc[label="1D channel\nfilter"] fcp
    ft[label="1D time\nfilter"] ftp
    sasis[label="signal\ndecon'ed"]
    sfull[label="signal\nshifted"]
    s[label="signal\ncropped"]

    node[shape=ellipse]
    maxshape[label="max measure\nshape\nconfig",color=red]
    mshape[label="m.shape",color=red]
    rshape[label="r.shape"]
    fftshape[label="shape"]
    bestshape[label="shape"]

    // Fourier
    node[shape=circle]
    M[color=red]
    R[color=blue]
    Fc
    Ft
    F[label="F = 2D\nfilter", color=blue]
    S

    // operations
    node[shape=diamond]
    shape_m[label="get\nshape",color=red]
    shape_r[label="get\nshape"]
    pad_m[label="pad"]
    pad_r[label="pad"]
    pad_fc[label="pad"]
    pad_ft[label="pad"]
    fft_m[label="2D \nDFT"]
    fft_r[label="2D \nDFT"]
    fft_fc[label="1D \nDFT"]
    fft_ft[label="1D \nDFT"]
    infft[label="2D inv\nDFT"]
    cross[label="outer\nproduct"]
    fft_shape[label="FFT min\nshape\nm+r-1"]
    best_shape[label="FFT best\nshape"]
    decon[label="decon\nM*F/R"]
    shift
    crop

    maxshape->fft_shape[color=red]
    m->shape_m->mshape->fft_shape[color=red]
    r->shape_r->rshape->fft_shape->fftshape
    fftshape->best_shape->bestshape
    
    bestshape->pad_m
    bestshape->pad_r
    bestshape->pad_fc
    bestshape->pad_ft

    m->pad_m->mp->fft_m->M->decon
    r->pad_r->rp->fft_r->R->decon

    fc->pad_fc->fcp->fft_fc->Fc->cross
    ft->pad_ft->ftp->fft_ft->Ft->cross->F->decon

    decon->S->infft->sasis->shift->sfull->crop->s;

    }

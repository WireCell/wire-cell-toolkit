{"id":"wct-3aq","title":"Thin wrapper around HDF5 C library","description":"HIO simplifies the `hdf5.h` API with minimal C++ wrapper.\n\nNot all HDF5 functionality exposed.\n\nLives in the C++ namespace `WireCell::HIO` and files `hio/inc/WireCellHio/HIO.h` and `hio/src/HIO.cxx`.\n\nThe HIO API is based on functions, no objects other than STL containers.\n\nThe HDF5 `hid_t` opaque HDF5 ID is exposed by HIO functions.\n\nThe HIO API provides `enum struct` to hold HDF5 constants.  For example, `enum struct FileMode` has a member `trunc` set to `H5F_ACC_TRUNC` and etc for `excl`, `rdrw` and `rdonly` constants.  These are used in `open()`.  Also `enum struct DataType` enumerates `int16`, `int32`, `int64`, `float32`, `float64` and `bool` types for creating datasets.\n\nHIO functions will interpret any `hdf5.h` function return and will throws the Wire-Cell Toolkit exception `IOError` with a meaningful messages using `raise\u003cIOError\u003e(\"message\")`.\n\nThe low level HIO.h API provides these functions:\n\n- `hid_t open(const std::string\u0026 filename, FileMode mode=FileMode::rdonly);`\n\nCreates or opens a file based on the mode, returns the file ID or throws IOError.\n\n- `void close(hid_t file_id);`\n\nCloses the file.\n\n- `void write_dataset(hid_t file_id, std::byte* data, const std::vector\u003cint64_t\u003e\u0026 shape, DataType dtype, const std::string\u0026 datapath);`\n\nWrite a dataset to a file.  The data set is given by `data` pointer to bytes, a shape and a `DataType` (An enum struct as described above) and is saved to the given HDF5 `datapath`.\n\n- `void template\u003ctypename T\u003e void write_dataset(hid_t file_id, const std::vector\u003cT\u003e\u0026 data, const std::vector\u003cint64_t\u003e\u0026 shape, const std::string\u0026 datapath);`\n\nWrite a typed dataset.  This is same but instead of a `DataType` enum, the type is inferred via the C++ template.\n\n- `void read_dataset(hid_t file_id, std::vector\u003cstd::byte\u003e\u0026 data, std::vector\u003cint64_t\u003e\u0026 shape, const std::string\u0026 datapath);`\n\nRead a dataset array from the given datapath into the data vector as bytes and set its shape.\n\n- `template\u003ctypename T\u003e void read_dataset(hid_t file_id, std::vector\u003cT\u003e\u0026 data, std::vector\u003cint64_t\u003e\u0026 shape, const std::string\u0026 datapath);`\n\nAs above but get type from the template parameter.\n\n- `void write_metadata(hid_t file_id, const Configuration\u0026 metadata, const std::string\u0026 datapath);`\n\nWrite metadata to the datapath.  The `Configuration` object is a JsonCPP `Json::Value`.\n\n- `Configuration read_metadata(hid_t file_id, const std::string\u0026 datapath);`\n\nRead and return the metadata at the given `datapath` as a `Configuration` object.  If no metadata is at that datapath, return an empty `Configuration object`.\n","notes":"## Implementation Summary\n\nCreated HIO.h and HIO.cxx implementing a thin C++ wrapper around the HDF5 C library.\n\n### Design Decisions\n\n1. **Namespace**: Used `WireCell::Hio` (title case) to match existing code in HDF5FrameTap.h\n\n2. **FileMode**: Implemented as struct with static inline const members rather than enum struct, since H5F_ACC_* macros are not constexpr-compatible. Usage: `FileMode::rdonly`, `FileMode::trunc`, etc.\n\n3. **DataType enum**: Removed `bool_type` because std::vector\u003cbool\u003e is specialized in C++ and doesn't have a .data() method, making it incompatible with HDF5's contiguous memory requirements. Supports int16, int32, int64, float32, float64.\n\n4. **Template instantiations**: Used explicit template instantiations in the .cxx file for common types (int16_t, int32_t, int64_t, float, double) with extern declarations in header.\n\n5. **Metadata handling**: Auto-detects whether datapath points to dataset or group using H5E_BEGIN_TRY/H5E_END_TRY blocks. Serializes complex JSON types (arrays/objects) as JSON strings in HDF5 attributes.\n\n6. **HDF5 version compatibility**: Added version check for H5Oget_info vs H5Oget_info3 (changed in HDF5 1.12.0).\n\n### Files Created\n\n- `hio/inc/WireCellHio/HIO.h` - Header with function declarations and enum definitions\n- `hio/src/HIO.cxx` - Implementation with error checking, path creation, and JSON metadata serialization\n\n### Build Status\n\n✓ Successfully builds with ./wcb\n✓ Links into libWireCellHio.so","status":"closed","priority":2,"issue_type":"task","owner":"brett.viren@gmail.com","created_at":"2026-02-03T11:20:16.381864059-05:00","created_by":"Brett Viren","updated_at":"2026-02-03T12:25:58.757454521-05:00","closed_at":"2026-02-03T12:25:58.757454521-05:00","close_reason":"Closed"}
{"id":"wct-6er","title":"Add an ITensorSetSink to HDF5 format","description":"Add it under hio/ name it HioTensorSink.","status":"open","priority":2,"issue_type":"task","owner":"brett.viren@gmail.com","created_at":"2026-02-03T11:17:54.274528596-05:00","created_by":"Brett Viren","updated_at":"2026-02-03T11:17:54.274528596-05:00","dependencies":[{"issue_id":"wct-6er","depends_on_id":"wct-90j","type":"blocks","created_at":"2026-02-03T11:23:05.176424501-05:00","created_by":"Brett Viren"},{"issue_id":"wct-6er","depends_on_id":"wct-nli","type":"blocks","created_at":"2026-02-03T11:23:10.117138767-05:00","created_by":"Brett Viren"}]}
{"id":"wct-90j","title":"Function to serialize ITensor to HDF5","description":"This requires handling both tensors and metadata.","status":"open","priority":2,"issue_type":"task","owner":"brett.viren@gmail.com","created_at":"2026-02-03T11:21:20.06096301-05:00","created_by":"Brett Viren","updated_at":"2026-02-03T11:21:20.06096301-05:00"}
{"id":"wct-nli","title":"Function to serialize ITensorSet to HDF5","description":"This requires set level metadata, iterating on tensors and recording some \"set\" association in HDF5.","status":"open","priority":2,"issue_type":"task","owner":"brett.viren@gmail.com","created_at":"2026-02-03T11:21:56.531871617-05:00","created_by":"Brett Viren","updated_at":"2026-02-03T11:21:56.531871617-05:00"}
{"id":"wct-pxu","title":"Add an ITensorSetSource to HDF5 format","description":"Add it under hio/ name it HioTensorSource.","status":"open","priority":2,"issue_type":"task","owner":"brett.viren@gmail.com","created_at":"2026-02-03T11:18:10.710048682-05:00","created_by":"Brett Viren","updated_at":"2026-02-03T11:18:10.710048682-05:00","dependencies":[{"issue_id":"wct-pxu","depends_on_id":"wct-90j","type":"blocks","created_at":"2026-02-03T11:22:47.625823723-05:00","created_by":"Brett Viren"},{"issue_id":"wct-pxu","depends_on_id":"wct-nli","type":"blocks","created_at":"2026-02-03T11:22:53.584723644-05:00","created_by":"Brett Viren"}]}
